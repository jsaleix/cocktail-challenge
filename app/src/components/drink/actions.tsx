"use client";

import { CocktailFullI } from "@/lib/types/cocktail";
import Btn from "../common/btn";
import { useAppContext } from "@/contexts/app.context";
import { useEffect, useRef, useState } from "react";

interface Props {
  drink: CocktailFullI;
}

export default function Actions({ drink }: Props) {
  const { isLiked, saveItem, removeItem } = useAppContext();
  const liked = isLiked(drink.idDrink);

  const toggleSave = () => {
    if (liked) {
      removeItem(drink.idDrink);
    } else {
      saveItem({
        idDrink: drink.idDrink,
        strDrink: drink.strDrink,
        strDrinkThumb: drink.strDrinkThumb,
      });
    }
  };

  return (
    <div id="drink-actions" className="flex flex-col gap-3 w-full">
      {!liked && (
        <Btn onClick={toggleSave}>
          <svg
            width="14"
            height="14"
            viewBox="0 0 14 14"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M13.8541 7.50879H8.23804V13.1248H6.36603V7.50879H0.75V5.63678H6.36603V0.020752H8.23804V5.63678H13.8541V7.50879Z"
              fill="white"
              className="group-hover:fill-black duration-500"
            />
          </svg>
          Save
        </Btn>
      )}
      {liked && (
        <Btn reverse onClick={toggleSave}>
          <svg
            width="14"
            height="14"
            viewBox="0 0 16 16"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M16 2.91L13.09 0L8 5.09L2.91 0L0 2.91L5.09 8L0 13.09L2.91 16L8 10.91L13.09 16L16 13.09L10.91 8L16 2.91Z"
              fill="black"
              className="group-hover:fill-white duration-500"
            />
          </svg>
          Remove
        </Btn>
      )}
      <CopyLinkBtn />
    </div>
  );
}

const DELAY = 3000; // 3 seconds

function CopyLinkBtn() {
  const [clicked, setClicked] = useState(false);
  let timer = useRef<null | ReturnType<typeof setTimeout>>(null);

  const copyLink = () => {
    const url = window.location.href;
    navigator.clipboard.writeText(url);
    setClicked(true);
  };

  useEffect(() => {
    if (clicked) {
      timer.current = setTimeout(() => {
        setClicked(false);
      }, DELAY);
    }
    return () => {
      if (timer.current) {
        clearTimeout(timer.current);
      }
    };
  }, [clicked]);

  if (clicked)
    return (
      <Btn className={"bg-white !text-black"}>
        <svg
          width="15"
          height="17"
          viewBox="0 0 233 200"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M106.18 160.74C107.298 161.855 108.186 163.179 108.792 164.638C109.397 166.097 109.709 167.661 109.709 169.24C109.709 170.819 109.397 172.383 108.792 173.842C108.186 175.3 107.298 176.625 106.18 177.74L101.06 182.86C95.6247 188.315 89.1622 192.639 82.0458 195.581C74.9293 198.523 67.3003 200.025 59.5998 200C48.0031 200.004 36.6659 196.568 27.0224 190.127C17.3789 183.686 9.86256 174.529 5.4242 163.815C0.98584 153.102 -0.175062 141.312 2.08836 129.939C4.35178 118.565 9.93782 108.118 18.1398 99.9199L52.8898 65.1699C60.2811 57.7797 69.5134 52.4993 79.6309 49.8755C89.7484 47.2516 100.383 47.3797 110.435 50.2464C120.486 53.1131 129.588 58.6143 136.8 66.1804C144.011 73.7465 149.069 83.1025 151.45 93.2799C151.844 94.8273 151.926 96.4379 151.69 98.0172C151.453 99.5966 150.905 101.113 150.075 102.477C149.245 103.842 148.152 105.027 146.858 105.963C145.565 106.9 144.097 107.569 142.542 107.931C140.987 108.293 139.375 108.341 137.801 108.072C136.227 107.803 134.722 107.223 133.375 106.365C132.028 105.507 130.866 104.389 129.957 103.076C129.048 101.763 128.409 100.282 128.08 98.7199C126.667 92.7122 123.675 87.1909 119.414 82.7267C115.152 78.2626 109.776 75.0176 103.84 73.3272C97.9047 71.6369 91.6254 71.5625 85.6514 73.1118C79.6775 74.6611 74.2257 77.7779 69.8598 82.1399L35.1098 116.89C30.2659 121.73 26.966 127.898 25.6276 134.613C24.2892 141.329 24.9723 148.29 27.5905 154.617C30.2087 160.944 34.6445 166.353 40.3368 170.159C46.0291 173.965 52.7222 175.998 59.5698 176C64.1196 176.013 68.6269 175.124 72.8306 173.383C77.0344 171.643 80.8511 169.086 84.0598 165.86L89.1698 160.74C90.2848 159.62 91.6101 158.731 93.0697 158.124C94.5292 157.518 96.0942 157.205 97.6748 157.205C99.2553 157.205 100.82 157.518 102.28 158.124C103.739 158.731 105.065 159.62 106.18 160.74ZM215.83 17.1699C204.831 6.17507 189.916 -0.00146484 174.365 -0.00146484C158.813 -0.00146484 143.898 6.17507 132.9 17.1699L127.79 22.2799C125.535 24.5342 124.269 27.5918 124.269 30.7799C124.269 33.968 125.535 37.0256 127.79 39.2799C130.044 41.5342 133.102 42.8007 136.29 42.8007C139.478 42.8007 142.535 41.5342 144.79 39.2799L149.91 34.1599C156.408 27.6621 165.22 24.0117 174.41 24.0117C183.599 24.0117 192.412 27.6621 198.91 34.1599C205.408 40.6577 209.058 49.4706 209.058 58.6599C209.058 67.8492 205.408 76.6621 198.91 83.1599L164.1 117.86C160.891 121.086 157.074 123.643 152.871 125.383C148.667 127.124 144.16 128.013 139.61 128C131.805 127.994 124.23 125.352 118.115 120.502C112 115.652 107.703 108.879 105.92 101.28C105.198 98.1795 103.275 95.4927 100.573 93.8105C97.8701 92.1283 94.6102 91.5885 91.5098 92.3099C88.4094 93.0313 85.7226 94.9548 84.0404 97.6572C82.3582 100.36 81.8184 103.62 82.5398 106.72C85.5508 119.589 92.8208 131.063 103.171 139.282C113.521 147.501 126.343 151.982 139.56 152H139.61C147.314 152.021 154.946 150.514 162.064 147.567C169.182 144.62 175.645 140.291 181.08 134.83L215.83 100.08C221.274 94.6364 225.593 88.1736 228.54 81.0607C231.487 73.9478 233.004 66.324 233.004 58.6249C233.004 50.9258 231.487 43.3021 228.54 36.1891C225.593 29.0762 221.274 22.6134 215.83 17.1699Z"
            fill="gray"
          />
        </svg>
        Copied!
      </Btn>
    );
  return (
    <Btn onClick={copyLink}>
      <svg
        width="15"
        height="17"
        viewBox="0 0 233 200"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M106.18 160.74C107.298 161.855 108.186 163.179 108.792 164.638C109.397 166.097 109.709 167.661 109.709 169.24C109.709 170.819 109.397 172.383 108.792 173.842C108.186 175.3 107.298 176.625 106.18 177.74L101.06 182.86C95.6247 188.315 89.1622 192.639 82.0458 195.581C74.9293 198.523 67.3003 200.025 59.5998 200C48.0031 200.004 36.6659 196.568 27.0224 190.127C17.3789 183.686 9.86256 174.529 5.4242 163.815C0.98584 153.102 -0.175062 141.312 2.08836 129.939C4.35178 118.565 9.93782 108.118 18.1398 99.9199L52.8898 65.1699C60.2811 57.7797 69.5134 52.4993 79.6309 49.8755C89.7484 47.2516 100.383 47.3797 110.435 50.2464C120.486 53.1131 129.588 58.6143 136.8 66.1804C144.011 73.7465 149.069 83.1025 151.45 93.2799C151.844 94.8273 151.926 96.4379 151.69 98.0172C151.453 99.5966 150.905 101.113 150.075 102.477C149.245 103.842 148.152 105.027 146.858 105.963C145.565 106.9 144.097 107.569 142.542 107.931C140.987 108.293 139.375 108.341 137.801 108.072C136.227 107.803 134.722 107.223 133.375 106.365C132.028 105.507 130.866 104.389 129.957 103.076C129.048 101.763 128.409 100.282 128.08 98.7199C126.667 92.7122 123.675 87.1909 119.414 82.7267C115.152 78.2626 109.776 75.0176 103.84 73.3272C97.9047 71.6369 91.6254 71.5625 85.6514 73.1118C79.6775 74.6611 74.2257 77.7779 69.8598 82.1399L35.1098 116.89C30.2659 121.73 26.966 127.898 25.6276 134.613C24.2892 141.329 24.9723 148.29 27.5905 154.617C30.2087 160.944 34.6445 166.353 40.3368 170.159C46.0291 173.965 52.7222 175.998 59.5698 176C64.1196 176.013 68.6269 175.124 72.8306 173.383C77.0344 171.643 80.8511 169.086 84.0598 165.86L89.1698 160.74C90.2848 159.62 91.6101 158.731 93.0697 158.124C94.5292 157.518 96.0942 157.205 97.6748 157.205C99.2553 157.205 100.82 157.518 102.28 158.124C103.739 158.731 105.065 159.62 106.18 160.74ZM215.83 17.1699C204.831 6.17507 189.916 -0.00146484 174.365 -0.00146484C158.813 -0.00146484 143.898 6.17507 132.9 17.1699L127.79 22.2799C125.535 24.5342 124.269 27.5918 124.269 30.7799C124.269 33.968 125.535 37.0256 127.79 39.2799C130.044 41.5342 133.102 42.8007 136.29 42.8007C139.478 42.8007 142.535 41.5342 144.79 39.2799L149.91 34.1599C156.408 27.6621 165.22 24.0117 174.41 24.0117C183.599 24.0117 192.412 27.6621 198.91 34.1599C205.408 40.6577 209.058 49.4706 209.058 58.6599C209.058 67.8492 205.408 76.6621 198.91 83.1599L164.1 117.86C160.891 121.086 157.074 123.643 152.871 125.383C148.667 127.124 144.16 128.013 139.61 128C131.805 127.994 124.23 125.352 118.115 120.502C112 115.652 107.703 108.879 105.92 101.28C105.198 98.1795 103.275 95.4927 100.573 93.8105C97.8701 92.1283 94.6102 91.5885 91.5098 92.3099C88.4094 93.0313 85.7226 94.9548 84.0404 97.6572C82.3582 100.36 81.8184 103.62 82.5398 106.72C85.5508 119.589 92.8208 131.063 103.171 139.282C113.521 147.501 126.343 151.982 139.56 152H139.61C147.314 152.021 154.946 150.514 162.064 147.567C169.182 144.62 175.645 140.291 181.08 134.83L215.83 100.08C221.274 94.6364 225.593 88.1736 228.54 81.0607C231.487 73.9478 233.004 66.324 233.004 58.6249C233.004 50.9258 231.487 43.3021 228.54 36.1891C225.593 29.0762 221.274 22.6134 215.83 17.1699Z"
          fill="white"
          className={"group-hover:fill-black duration-500"}
        />
      </svg>
      Share
    </Btn>
  );
}
